db_id|question|generated_sql_query|gold_sql_query|result
bigquery-public-data.ga4_obfuscated_sample_ecommerce|How many pseudo users were active in the last 7 days but inactive in the last 2 days as of January 7, 2021?|with userslast7days as ( select distinct user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210101 union distinct select distinct user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210102 union distinct select distinct user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210103 union distinct select distinct user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210104 union distinct select distinct user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210105 union distinct select distinct user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210106 union distinct select distinct user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210107 ), userslast2days as ( select distinct user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210105 union distinct select distinct user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210106 ) select count(userslast7days.user_pseudo_id) from userslast7days left join userslast2days on userslast7days.user_pseudo_id = userslast2days.user_pseudo_id where userslast2days.user_pseudo_id is null|select count(distinct mdaysusers.user_pseudo_id) as n_day_inactive_users_count from ( select user_pseudo_id from `bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*` as t cross join unnest(t.event_params) as event_params where event_params.key = 'engagement_time_msec' and event_params.value.int_value > 0 /* has engaged in last m = 7 days */ and event_timestamp > unix_micros(timestamp_sub(timestamp('2021-01-07 23:59:59'), interval 7 day)) /* include only relevant tables based on the fixed timestamp */ and _table_suffix between '20210101' and '20210107' ) as mdaysusers left join ( select user_pseudo_id from `bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*` as t cross join unnest(t.event_params) as event_params where event_params.key = 'engagement_time_msec' and event_params.value.int_value > 0 /* has engaged in last n = 2 days */ and event_timestamp > unix_micros(timestamp_sub(timestamp('2021-01-07 23:59:59'), interval 2 day)) /* include only relevant tables based on the fixed timestamp */ and _table_suffix between '20210105' and '20210107' ) as ndaysusers on mdaysusers.user_pseudo_id = ndaysusers.user_pseudo_id where ndaysusers.user_pseudo_id is null;|
bigquery-public-data.google_analytics_sample|Find the top-selling product among customers who bought 'Youtube Men’s Vintage Henley' in July 2017, excluding itself.|with july2017sessions as ( select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170716 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170722 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731 ), henleybuyers as ( select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710, unnest(hits) as hits where hits.item.productname = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713, unnest(hits) as hits where hits.item.productname = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170716, unnest(hits) as hits where hits.item.productname = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719, unnest(hits) as hits where hits.item.productname = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721, unnest(hits) as hits where hits.item.productname = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170722, unnest(hits) as hits where hits.item.productname = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724, unnest(hits) as hits where hits.item.productname = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725, unnest(hits) as hits where hits.item.productname = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727, unnest(hits) as hits where hits.item.productname = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729, unnest(hits) as hits where hits.item.productname = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731, unnest(hits) as hits where hits.item.productname = 'youtube men’s vintage henley' ), henleybuyersjuly2017 as ( select fullvisitorid from henleybuyers inner join july2017sessions on henleybuyers.fullvisitorid = july2017sessions.fullvisitorid ), productpurchases as ( select fullvisitorid, hits.item.productname, sum(hits.item.itemquantity) as totalquantity from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710, unnest(hits) as hits where hits.item.productname <> 'youtube men’s vintage henley' group by fullvisitorid, hits.item.productname union all select fullvisitorid, hits.item.productname, sum(hits.item.itemquantity) as totalquantity from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713, unnest(hits) as hits where hits.item.productname <> 'youtube men’s vintage henley' group by fullvisitorid, hits.item.productname union all select fullvisitorid, hits.item.productname, sum(hits.item.itemquantity) as totalquantity from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170716, unnest(hits) as hits where hits.item.productname <> 'youtube men’s vintage henley' group by fullvisitorid, hits.item.productname union all select fullvisitorid, hits.item.productname, sum(hits.item.itemquantity) as totalquantity from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719, unnest(hits) as hits where hits.item.productname <> 'youtube men’s vintage henley' group by fullvisitorid, hits.item.productname union all select fullvisitorid, hits.item.productname, sum(hits.item.itemquantity) as totalquantity from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721, unnest(hits) as hits where hits.item.productname <> 'youtube men’s vintage henley' group by fullvisitorid, hits.item.productname union all select fullvisitorid, hits.item.productname, sum(hits.item.itemquantity) as totalquantity from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170722, unnest(hits) as hits where hits.item.productname <> 'youtube men’s vintage henley' group by fullvisitorid, hits.item.productname union all select fullvisitorid, hits.item.productname, sum(hits.item.itemquantity) as totalquantity from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724, unnest(hits) as hits where hits.item.productname <> 'youtube men’s vintage henley' group by fullvisitorid, hits.item.productname union all select fullvisitorid, hits.item.productname, sum(hits.item.itemquantity) as totalquantity from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725, unnest(hits) as hits where hits.item.productname <> 'youtube men’s vintage henley' group by fullvisitorid, hits.item.productname union all select fullvisitorid, hits.item.productname, sum(hits.item.itemquantity) as totalquantity from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727, unnest(hits) as hits where hits.item.productname <> 'youtube men’s vintage henley' group by fullvisitorid, hits.item.productname union all select fullvisitorid, hits.item.productname, sum(hits.item.itemquantity) as totalquantity from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729, unnest(hits) as hits where hits.item.productname <> 'youtube men’s vintage henley' group by fullvisitorid, hits.item.productname union all select fullvisitorid, hits.item.productname, sum(hits.item.itemquantity) as totalquantity from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731, unnest(hits) as hits where hits.item.productname <> 'youtube men’s vintage henley' group by fullvisitorid, hits.item.productname ) select productname, sum(totalquantity) as totalquantitysold from productpurchases where fullvisitorid in (select fullvisitorid from henleybuyersjuly2017) group by productname order by totalquantitysold desc limit 1|"with get_cus_id as ( select distinct fullvisitorid as henley_customer_id from `bigquery-public-data.google_analytics_sample.ga_sessions_201707*`, unnest(hits) as hits, unnest(hits.product) as product where product.v2productname = ""youtube men's vintage henley"" and product.productrevenue is not null ) select product.v2productname as other_purchased_products from `bigquery-public-data.google_analytics_sample.ga_sessions_201707*` tab_a right join get_cus_id on get_cus_id.henley_customer_id=tab_a.fullvisitorid, unnest(hits) as hits, unnest(hits.product) as product where tab_a.fullvisitorid in ( select * from get_cus_id ) and product.v2productname <> ""youtube men's vintage henley"" and product.productrevenue is not null group by product.v2productname order by sum(product.productquantity) desc limit 1;"|
bigquery-public-data.google_analytics_sample|Which traffic source receives the top revenue in 2017 and what is the difference (millions, rounded to two decimal places) between its highest and lowest revenue months?|with monthlyrevenue as ( select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170101 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170102 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170103 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170104 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170105 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170106 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170107 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170108 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170109 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170110 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170111 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170112 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170113 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170114 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170115 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170116 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170117 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170118 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170119 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170120 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170121 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170122 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170123 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170124 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170125 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170126 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170127 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170128 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170129 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170130 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170131 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170201 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170202 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170203 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170204 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170205 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170206 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170207 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170208 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170209 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170210 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170211 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170212 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170213 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170214 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170215 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170216 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170217 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170218 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170219 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170220 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170221 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170222 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170223 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170224 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170225 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170226 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170227 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170228 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170301 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170302 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170303 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170304 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170305 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170306 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170307 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170308 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170309 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170310 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170311 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170312 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170313 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170314 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170315 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170316 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170317 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170318 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170319 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170320 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170321 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170322 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170323 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170324 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170325 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170326 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170327 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170328 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170329 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170330 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170331 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170401 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170402 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170403 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170404 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170405 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170406 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170407 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170408 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170409 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170410 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170411 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170412 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170413 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170414 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170415 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170416 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170417 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170418 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170419 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170420 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170421 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170422 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170423 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170424 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170425 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170426 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170427 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170428 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170429 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170430 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170501 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170502 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170503 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170504 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170505 union all select date, trafficsource.source as source, sum(totals.totaltransactionrevenue) as monthly_revenue from `bigquery-public-data`.google_analytics_sample.ga_sessions_201705|"with monthly_revenue as ( select format_date(""%y%m"", parse_date(""%y%m%d"", date)) as month, trafficsource.source as source, round(sum(totals.totaltransactionrevenue) / 1000000, 2) as revenue from `bigquery-public-data.google_analytics_sample.ga_sessions_2017*` group by 1, 2 ), yearly_revenue as ( select source, sum(revenue) as total_revenue from monthly_revenue group by source ), top_source as ( select source from yearly_revenue order by total_revenue desc limit 1 ), source_monthly_revenue as ( select month, source, revenue from monthly_revenue where source in (select source from top_source) ), revenue_diff as ( select source, round(max(revenue), 2) as max_revenue, round(min(revenue), 2) as min_revenue, round(max(revenue) - min(revenue), 2) as diff_revenue from source_monthly_revenue group by source ) select source, diff_revenue from revenue_diff;"|
