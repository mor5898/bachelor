db_id|question|generated_sql_query|gold_sql_query|result
bigquery-public-data.ga4_obfuscated_sample_ecommerce|How many pseudo users were active in the last 7 days but inactive in the last 2 days as of January 7, 2021?|with activeusers as ( select user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210101 where cast(event_date as date) between date('2021-01-01') and date('2021-01-07') group by 1 ), inactiveusers as ( select user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210101 where cast(event_date as date) between date('2021-01-05') and date('2021-01-07') group by 1 ) select count(distinct activeusers.user_pseudo_id) from activeusers left join inactiveusers on activeusers.user_pseudo_id = inactiveusers.user_pseudo_id where inactiveusers.user_pseudo_id is null;|select count(distinct mdaysusers.user_pseudo_id) as n_day_inactive_users_count from ( select user_pseudo_id from `bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*` as t cross join unnest(t.event_params) as event_params where event_params.key = 'engagement_time_msec' and event_params.value.int_value > 0 /* has engaged in last m = 7 days */ and event_timestamp > unix_micros(timestamp_sub(timestamp('2021-01-07 23:59:59'), interval 7 day)) /* include only relevant tables based on the fixed timestamp */ and _table_suffix between '20210101' and '20210107' ) as mdaysusers left join ( select user_pseudo_id from `bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*` as t cross join unnest(t.event_params) as event_params where event_params.key = 'engagement_time_msec' and event_params.value.int_value > 0 /* has engaged in last n = 2 days */ and event_timestamp > unix_micros(timestamp_sub(timestamp('2021-01-07 23:59:59'), interval 2 day)) /* include only relevant tables based on the fixed timestamp */ and _table_suffix between '20210105' and '20210107' ) as ndaysusers on mdaysusers.user_pseudo_id = ndaysusers.user_pseudo_id where ndaysusers.user_pseudo_id is null;|
bigquery-public-data.google_analytics_sample|Find the top-selling product among customers who bought 'Youtube Men’s Vintage Henley' in July 2017, excluding itself.|with sessions as ( select s.visitid, s.fullvisitorid, s.visitstarttime, s.date from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710 as s where s.date between '20170701' and '20170731' ), purchases as ( select s.visitid, s.fullvisitorid, s.visitstarttime, s.date, h.item.productname from sessions as s inner join s.hits as h on h.item.productname is not null ), customerpurchases as ( select distinct p.fullvisitorid, p.visitid, p.productname from purchases as p ), youtubehenleypurchases as ( select distinct c.fullvisitorid, c.visitid from customerpurchases as c where c.productname = 'youtube men’s vintage henley' ), allotherproducts as ( select distinct c.fullvisitorid, c.productname from customerpurchases as c where c.visitid in ( select yh.visitid from youtubehenleypurchases as yh ) and c.productname != 'youtube men’s vintage henley' ), topsellingproduct as ( select ap.productname, count(ap.fullvisitorid) as purchase_count from allotherproducts as ap group by 1 order by purchase_count desc limit 1 ) select tsp.productname, tsp.purchase_count from topsellingproduct as tsp;|"with get_cus_id as ( select distinct fullvisitorid as henley_customer_id from `bigquery-public-data.google_analytics_sample.ga_sessions_201707*`, unnest(hits) as hits, unnest(hits.product) as product where product.v2productname = ""youtube men's vintage henley"" and product.productrevenue is not null ) select product.v2productname as other_purchased_products from `bigquery-public-data.google_analytics_sample.ga_sessions_201707*` tab_a right join get_cus_id on get_cus_id.henley_customer_id=tab_a.fullvisitorid, unnest(hits) as hits, unnest(hits.product) as product where tab_a.fullvisitorid in ( select * from get_cus_id ) and product.v2productname <> ""youtube men's vintage henley"" and product.productrevenue is not null group by product.v2productname order by sum(product.productquantity) desc limit 1;"|
