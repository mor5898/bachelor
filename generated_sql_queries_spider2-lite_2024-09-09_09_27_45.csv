db_id|question|generated_sql_query|gold_sql_query
bigquery-public-data.ga4_obfuscated_sample_ecommerce|How many pseudo users were active in the last 7 days but inactive in the last 2 days as of January 7, 2021?|with dailyactiveusers as ( select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210101 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210102 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210103 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210104 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210105 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210106 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210107 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210108 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210109 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210110 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210111 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210112 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210113 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210114 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210115 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210116 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210117 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210118 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210119 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210120 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210121 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210122 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210123 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210124 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210125 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210126 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210127 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210128 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210129 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210130 union all select event_date, user_pseudo_id from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_20210131 ), last7daysactiveusers as ( select distinct user_pseudo_id from dailyactiveusers where event_date >= '20210101' ), last2daysactiveusers as ( select distinct user_pseudo_id from dailyactiveusers where event_date >= '20210105' ) select count(distinct user_pseudo_id) from last7daysactiveusers where user_pseudo_id not in ( select user_pseudo_id from last2daysactiveusers );|select count(distinct mdaysusers.user_pseudo_id) as n_day_inactive_users_count from ( select user_pseudo_id from `bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*` as t cross join unnest(t.event_params) as event_params where event_params.key = 'engagement_time_msec' and event_params.value.int_value > 0 /* has engaged in last m = 7 days */ and event_timestamp > unix_micros(timestamp_sub(timestamp('2021-01-07 23:59:59'), interval 7 day)) /* include only relevant tables based on the fixed timestamp */ and _table_suffix between '20210101' and '20210107' ) as mdaysusers left join ( select user_pseudo_id from `bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*` as t cross join unnest(t.event_params) as event_params where event_params.key = 'engagement_time_msec' and event_params.value.int_value > 0 /* has engaged in last n = 2 days */ and event_timestamp > unix_micros(timestamp_sub(timestamp('2021-01-07 23:59:59'), interval 2 day)) /* include only relevant tables based on the fixed timestamp */ and _table_suffix between '20210105' and '20210107' ) as ndaysusers on mdaysusers.user_pseudo_id = ndaysusers.user_pseudo_id where ndaysusers.user_pseudo_id is null;
bigquery-public-data.google_analytics_sample|Find the top-selling product among customers who bought 'Youtube Men’s Vintage Henley' in July 2017, excluding itself.|with july2017sessions as ( select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710 where totals.transactions > 0 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713 where totals.transactions > 0 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719 where totals.transactions > 0 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721 where totals.transactions > 0 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724 where totals.transactions > 0 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 where totals.transactions > 0 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727 where totals.transactions > 0 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729 where totals.transactions > 0 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731 where totals.transactions > 0 ), july2017henleycustomers as ( select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710, unnest(hits) as hit where hit.item.productsku = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713, unnest(hits) as hit where hit.item.productsku = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719, unnest(hits) as hit where hit.item.productsku = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721, unnest(hits) as hit where hit.item.productsku = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724, unnest(hits) as hit where hit.item.productsku = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725, unnest(hits) as hit where hit.item.productsku = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727, unnest(hits) as hit where hit.item.productsku = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729, unnest(hits) as hit where hit.item.productsku = 'youtube men’s vintage henley' union all select distinct fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731, unnest(hits) as hit where hit.item.productsku = 'youtube men’s vintage henley' ), july2017productsales as ( select hit.item.productsku, sum(hit.item.itemrevenue) as totalrevenue from july2017sessions, `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710, unnest(hits) as hit where `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710.fullvisitorid in ( select fullvisitorid from july2017henleycustomers ) and `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710.fullvisitorid = july2017sessions.fullvisitorid group by hit.item.productsku union all select hit.item.productsku, sum(hit.item.itemrevenue) as totalrevenue from july2017sessions, `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713, unnest(hits) as hit where `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713.fullvisitorid in ( select fullvisitorid from july2017henleycustomers ) and `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713.fullvisitorid = july2017sessions.fullvisitorid group by hit.item.productsku union all select hit.item.productsku, sum(hit.item.itemrevenue) as totalrevenue from july2017sessions, `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719, unnest(hits) as hit where `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719.fullvisitorid in ( select fullvisitorid from july2017henleycustomers ) and `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719.fullvisitorid = july2017sessions.fullvisitorid group by hit.item.productsku union all select hit.item.productsku, sum(hit.item.itemrevenue) as totalrevenue from july2017sessions, `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721, unnest(hits) as hit where `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721.fullvisitorid in ( select fullvisitorid from july2017henleycustomers ) and `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721.fullvisitorid = july2017sessions.fullvisitorid group by hit.item.productsku union all select hit.item.productsku, sum(hit.item.itemrevenue) as totalrevenue from july2017sessions, `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724, unnest(hits) as hit where `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724.fullvisitorid in ( select fullvisitorid from july2017henleycustomers ) and `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724.fullvisitorid = july2017sessions.fullvisitorid group by hit.item.productsku union all select hit.item.productsku, sum(hit.item.itemrevenue) as totalrevenue from july2017sessions, `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725, unnest(hits) as hit where `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725.fullvisitorid in ( select fullvisitorid from july2017henleycustomers ) and `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725.fullvisitorid = july2017sessions.fullvisitorid group by hit.item.productsku union all select hit.item.productsku, sum(hit.item.itemrevenue) as totalrevenue from july2017sessions, `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727, unnest(hits) as hit where `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727.fullvisitorid in ( select fullvisitorid from july2017henleycustomers ) and `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727.fullvisitorid = july2017sessions.fullvisitorid group by hit.item.productsku union all select hit.item.productsku, sum(hit.item.itemrevenue) as totalrevenue from july2017sessions, `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729, unnest(hits) as hit where `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729.fullvisitorid in ( select fullvisitorid from july2017henleycustomers ) and `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729.fullvisitorid = july2017sessions.fullvisitorid group by hit.item.productsku union all select hit.item.productsku, sum(hit.item.itemrevenue) as totalrevenue from july2017sessions, `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731, unnest(hits) as hit where `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731.fullvisitorid in ( select fullvisitorid from july2017henleycustomers ) and `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731.fullvisitorid = july2017sessions.fullvisitorid group by hit.item.productsku ) select productsku, totalrevenue from july2017productsales where productsku <> 'youtube men’s vintage henley' order by totalrevenue desc limit 1|"with get_cus_id as ( select distinct fullvisitorid as henley_customer_id from `bigquery-public-data.google_analytics_sample.ga_sessions_201707*`, unnest(hits) as hits, unnest(hits.product) as product where product.v2productname = ""youtube men's vintage henley"" and product.productrevenue is not null ) select product.v2productname as other_purchased_products from `bigquery-public-data.google_analytics_sample.ga_sessions_201707*` tab_a right join get_cus_id on get_cus_id.henley_customer_id=tab_a.fullvisitorid, unnest(hits) as hits, unnest(hits.product) as product where tab_a.fullvisitorid in ( select * from get_cus_id ) and product.v2productname <> ""youtube men's vintage henley"" and product.productrevenue is not null group by product.v2productname order by sum(product.productquantity) desc limit 1;"
