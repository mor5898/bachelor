db_id|question|generated_sql_query|gold_sql_query
bigquery-public-data.ga4_obfuscated_sample_ecommerce|How many pseudo users were active in the last 7 days but inactive in the last 2 days as of January 7, 2021?|with useractivity as ( select user_pseudo_id, event_date from `bigquery-public-data`.ga4_obfuscated_sample_ecommerce.events_* where cast(event_date as date) between date('2021-01-01') and date('2021-01-07') group by 1, 2 ) select count(distinct user_pseudo_id) from useractivity where cast(event_date as date) between date('2021-01-05') and date('2021-01-07') and user_pseudo_id not in ( select user_pseudo_id from useractivity where cast(event_date as date) between date('2021-01-06') and date('2021-01-07') )|select count(distinct mdaysusers.user_pseudo_id) as n_day_inactive_users_count from ( select user_pseudo_id from `bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*` as t cross join unnest(t.event_params) as event_params where event_params.key = 'engagement_time_msec' and event_params.value.int_value > 0 /* has engaged in last m = 7 days */ and event_timestamp > unix_micros(timestamp_sub(timestamp('2021-01-07 23:59:59'), interval 7 day)) /* include only relevant tables based on the fixed timestamp */ and _table_suffix between '20210101' and '20210107' ) as mdaysusers left join ( select user_pseudo_id from `bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*` as t cross join unnest(t.event_params) as event_params where event_params.key = 'engagement_time_msec' and event_params.value.int_value > 0 /* has engaged in last n = 2 days */ and event_timestamp > unix_micros(timestamp_sub(timestamp('2021-01-07 23:59:59'), interval 2 day)) /* include only relevant tables based on the fixed timestamp */ and _table_suffix between '20210105' and '20210107' ) as ndaysusers on mdaysusers.user_pseudo_id = ndaysusers.user_pseudo_id where ndaysusers.user_pseudo_id is null;
bigquery-public-data.google_analytics_sample|Find the top-selling product among customers who bought 'Youtube Men’s Vintage Henley' in July 2017, excluding itself.|with july_2017_sessions as ( select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170705 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170715 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170701 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170708 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170720 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170706 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170714 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170712 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170718 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170728 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170703 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170716 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170702 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170705 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170715 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170701 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170708 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170720 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170706 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170714 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170712 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170718 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170728 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170703 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170716 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170702 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170705 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170715 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170701 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170708 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170720 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170706 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170714 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170712 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170718 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170728 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170703 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170716 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170702 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170705 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170715 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170701 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170708 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170720 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170706 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170714 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170712 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170718 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170728 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170703 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170716 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170702 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170705 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170715 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170701 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170708 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170720 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170706 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170714 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170712 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170718 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170728 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170703 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170716 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170702 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170705 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170715 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170701 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170708 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170720 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170706 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170714 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170712 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170718 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170728 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170703 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170716 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170702 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170705 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170715 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170701 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170708 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170720 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170706 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170714 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170712 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170718 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170728 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170703 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170716 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170702 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170705 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170715 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170701 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170708 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170720 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170706 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170714 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170712 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170718 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170728 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170703 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170716 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170702 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170724 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170713 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170705 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170715 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170701 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170719 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170727 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170708 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170731 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170720 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170706 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170714 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170712 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170721 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170725 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170718 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170728 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170703 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170716 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170702 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170710 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.ga_sessions_20170729 union all select fullvisitorid from `bigquery-public-data`.google_analytics_sample.|"with get_cus_id as ( select distinct fullvisitorid as henley_customer_id from `bigquery-public-data.google_analytics_sample.ga_sessions_201707*`, unnest(hits) as hits, unnest(hits.product) as product where product.v2productname = ""youtube men's vintage henley"" and product.productrevenue is not null ) select product.v2productname as other_purchased_products from `bigquery-public-data.google_analytics_sample.ga_sessions_201707*` tab_a right join get_cus_id on get_cus_id.henley_customer_id=tab_a.fullvisitorid, unnest(hits) as hits, unnest(hits.product) as product where tab_a.fullvisitorid in ( select * from get_cus_id ) and product.v2productname <> ""youtube men's vintage henley"" and product.productrevenue is not null group by product.v2productname order by sum(product.productquantity) desc limit 1;"
bigquery-public-data.google_analytics_sample|Which traffic source receives the top revenue in 2017 and what is the difference (millions, rounded to two decimal places) between its highest and lowest revenue months?|with monthlyrevenue as ( select table_name, cast(substr(table_name, 10, 8) as date) as session_date, trafficsource.source as traffic_source, sum(totals.totaltransactionrevenue) as revenue from `bigquery-public-data`.google_analytics_sample.* where cast(substr(table_name, 10, 8) as date) between '2017-01-01' and '2017-12-31' group by 1, 2, 3 ), topsource as ( select traffic_source, sum(revenue) as total_revenue from monthlyrevenue group by 1 order by total_revenue desc limit 1 ), highestrevenuemonth as ( select traffic_source, session_date, revenue from monthlyrevenue where traffic_source = ( select traffic_source from topsource ) order by revenue desc limit 1 ), lowestrevenuemonth as ( select traffic_source, session_date, revenue from monthlyrevenue where traffic_source = ( select traffic_source from topsource ) order by revenue asc limit 1 ) select ( select traffic_source from topsource ) as top_traffic_source, round( ( select revenue from highestrevenuemonth ) - ( select revenue from lowestrevenuemonth ) ) / 1000000.0 as revenue_difference from topsource;|"with monthly_revenue as ( select format_date(""%y%m"", parse_date(""%y%m%d"", date)) as month, trafficsource.source as source, round(sum(totals.totaltransactionrevenue) / 1000000, 2) as revenue from `bigquery-public-data.google_analytics_sample.ga_sessions_2017*` group by 1, 2 ), yearly_revenue as ( select source, sum(revenue) as total_revenue from monthly_revenue group by source ), top_source as ( select source from yearly_revenue order by total_revenue desc limit 1 ), source_monthly_revenue as ( select month, source, revenue from monthly_revenue where source in (select source from top_source) ), revenue_diff as ( select source, round(max(revenue), 2) as max_revenue, round(min(revenue), 2) as min_revenue, round(max(revenue) - min(revenue), 2) as diff_revenue from source_monthly_revenue group by source ) select source, diff_revenue from revenue_diff;"
bigquery-public-data.google_analytics_sample|I wonder how many days between the first transaction and the first visit for each transacting visitor in Feburary 2017, along with the device used in the transaction.|with visitorsessions as ( select fullvisitorid, min(visitstarttime) as first_visit_time, min(totals.transactions) as first_transaction_time, array_agg(struct(hitnumber, hits.transaction.transactionid, hits.transaction.transactionrevenue, hits.transaction.currencycode, hits.item.productname, hits.item.productcategory, hits.item.productsku, hits.item.itemquantity, hits.item.itemrevenue, hits.item.currencycode, hits.device.devicecategory, hits.device.operatingsystem, hits.device.operatingsystemversion, hits.device.ismobile)) over (partition by fullvisitorid order by visitstarttime) as transactions from `bigquery-public-data`.google_analytics_sample.ga_sessions_201702* where totals.transactions > 0 ), firsttransactions as ( select fullvisitorid, first_visit_time, first_transaction_time, transactions[safe_offset(0)].devicecategory as devicecategory, transactions[safe_offset(0)].operatingsystem as operatingsystem, transactions[safe_offset(0)].operatingsystemversion as operatingsystemversion, transactions[safe_offset(0)].ismobile as ismobile from visitorsessions ) select fullvisitorid, (first_transaction_time - first_visit_time) / 86400 as days_between_first_transaction_and_visit, devicecategory, operatingsystem, operatingsystemversion, ismobile from firsttransactions;|declare start_date string default '20170201'; declare end_date string default '20170228'; with visit as ( select fullvisitorid, min(date) as date_first_visit from `bigquery-public-data.google_analytics_sample.ga_sessions_*` where _table_suffix between start_date and end_date group by fullvisitorid ), transactions as ( select fullvisitorid, min(date) as date_transactions from `bigquery-public-data.google_analytics_sample.ga_sessions_*` as ga, unnest(ga.hits) as hits where hits.transaction.transactionid is not null and _table_suffix between start_date and end_date group by fullvisitorid ), device_transactions as ( select distinct fullvisitorid, date, device.devicecategory from `bigquery-public-data.google_analytics_sample.ga_sessions_*` as ga, unnest(ga.hits) as hits where hits.transaction.transactionid is not null and _table_suffix between start_date and end_date ), visits_transactions as ( select visit.fullvisitorid, date_first_visit, date_transactions, device_transactions.devicecategory as device_transaction from visit join transactions on visit.fullvisitorid = transactions.fullvisitorid join device_transactions on visit.fullvisitorid = device_transactions.fullvisitorid and transactions.date_transactions = device_transactions.date ) select fullvisitorid, date_diff(parse_date('%y%m%d', date_transactions), parse_date('%y%m%d', date_first_visit), day) as time, device_transaction from visits_transactions order by fullvisitorid;
